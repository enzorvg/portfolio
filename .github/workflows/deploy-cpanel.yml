name: Deploy to cPanel

on:
  push:
    branches: ["main"]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Update repository on cPanel (pull)
        run: |
          curl -sS -H "Authorization: cpanel ${{ secrets.CPANEL_USER }}:${{ secrets.CPANEL_TOKEN }}" \
            "https://${{ secrets.CPANEL_HOST }}:2083/execute/VersionControl/update?repository_root=${{ secrets.CPANEL_REPO_ROOT }}&branch=main"

      - name: Deploy HEAD commit (.cpanel.yml)
        run: |
          curl -sS -H "Authorization: cpanel ${{ secrets.CPANEL_USER }}:${{ secrets.CPANEL_TOKEN }}" \
            "https://${{ secrets.CPANEL_HOST }}:2083/execute/VersionControlDeployment/create?repository_root=${{ secrets.CPANEL_REPO_ROOT }}"
